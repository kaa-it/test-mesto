(()=>{"use strict";var e={};function t(e){e.classList.remove("popup_opened")}function o(e){e.classList.add("popup_opened")}function n(e){o(document.querySelector("#picture")),document.querySelectorAll(".element__image-element").forEach((function(e){e.addEventListener("click",r,!0)}))}function r(e){var t=e.target,o=t.getAttribute("src"),n=t.getAttribute("alt");document.querySelector(".picture__images").setAttribute("src",o),document.querySelector(".picture__caption").textContent=n}e.p="";var c={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-2",headers:{authorization:"cbaadd20-b391-4efb-b28f-0fe45b806ecd","Content-Type":"application/json"}},u=fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e._id})).catch((function(e){console.log(e)})),i=fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log(e)}));const a=e.p+"e3b9ba5840ebe97bc077.svg",l=e.p+"35948469632d0421d697.svg";function s(e){var t=e.target;t.setAttribute("disabled",!0);var o=t.getAttribute("id");if(t.getAttribute("src")===a){var n=fetch("https://nomoreparties.co/v1/wbf-cohort-2/cards/likes/"+o,{method:"PUT",headers:{authorization:"cbaadd20-b391-4efb-b28f-0fe45b806ecd","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e);var t=e;return console.log("что возвращает Put? "+t),t})).catch((function(e){console.log(e)})),r=fetch("https://mesto.nomoreparties.co/v1/wbf-cohort-2/cards",{method:"GET",headers:{authorization:"cbaadd20-b391-4efb-b28f-0fe45b806ecd","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log(e)}));Promise.all([n,r]).then((function(e){e[0],e[1].forEach((function(e){var n=e;n._id===o&&(n.name,document.querySelectorAll(".element__likes").forEach((function(e){if(e.getAttribute("id")===o){var r=n.likes.length;e.textContent=r,t.setAttribute("src",l)}})))}))}))}else{var c=fetch("https://nomoreparties.co/v1/wbf-cohort-2/cards/likes/"+o,{method:"DELETE",headers:{authorization:"cbaadd20-b391-4efb-b28f-0fe45b806ecd","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log(e)})),u=fetch("https://mesto.nomoreparties.co/v1/wbf-cohort-2/cards",{method:"GET",headers:{authorization:"cbaadd20-b391-4efb-b28f-0fe45b806ecd","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log(e)}));Promise.all([c,u]).then((function(e){e[0],e[1].forEach((function(e){var n=e;n._id===o&&(n.name,document.querySelectorAll(".element__likes").forEach((function(e){if(e.getAttribute("id")===o){var r=n.likes.length;e.textContent=r,t.setAttribute("src",a)}})))}))}))}}function d(e){var t=e.target,o=t.getAttribute("id"),n=t.closest(".element");n.setAttribute("disabled",!0),n.remove(),function(e){var t=e;fetch("".concat(c.baseUrl,"/cards/")+t,{method:"DELETE",headers:c.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),initialCards})).catch((function(e){console.log(e)}))}(o)}var m,f,_,b,v,h;Promise.all([u,i]).then((function(e){var t=e[0];e[1].forEach((function(e){var o=e,r=document.querySelector(".elements"),c=document.querySelector("#card-template").content.querySelector(".element").cloneNode(!0);r.prepend(c);var u=r,i=o.name,l=o.link,m=o._id,f=o.likes.length,_=(document.querySelector(".element__likes").textContent=f,document.querySelector(".element__likes").setAttribute("id",m),o.owner._id);t===_?(u.querySelector(".delete").setAttribute("id","my"),u.querySelector(".delete").setAttribute("id",m),u.querySelector(".element__delete").addEventListener("click",d,!0)):(u.querySelector(".delete").setAttribute("id","not"),u.querySelector(".delete").removeAttribute("src")),u.querySelector(".like").setAttribute("src",a),u.querySelector(".like").setAttribute("id",m),u.querySelector(".element__picture").addEventListener("click",n,!0),u.querySelector(".element__vector").addEventListener("click",s,!0),document.querySelector(".element__likes").textContent=f,document.querySelector(".element__title").textContent=i,document.querySelector(".element__image-element").setAttribute("src",l),document.querySelector(".element__image-element").setAttribute("alt",i),document.querySelector(".element__image-element").setAttribute("id",m)}))})),m=document.querySelector("#profile-edit"),document.querySelector(".profile__edit-button").addEventListener("click",(function(){return o(m)})),f=document.querySelector("#editPhoto"),_=document.querySelector(".profile__avatar-img"),document.querySelector("#profileAddLink"),b=document.querySelector(".form-photo"),v=document.querySelector("#edit"),b.addEventListener("click",(function(e){if(e.target.classList.contains("form__submit-button")){var o=document.getElementById("profileAddLink").value;_.setAttribute("src",o),v.textContent="Сохранение...",fetch("https://mesto.nomoreparties.co/v1/wbf-cohort-2/users/me/",{method:"PATCH",headers:{authorization:"cbaadd20-b391-4efb-b28f-0fe45b806ecd","Content-Type":"application/json"},body:JSON.stringify({avatar:"valueImageSrcPhoto"})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)})),fetch("https://mesto.nomoreparties.co/v1/wbf-cohort-2/users/me",{headers:{authorization:"cbaadd20-b391-4efb-b28f-0fe45b806ecd"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)})),t(f),document.querySelector("#profileAddLink").value=" "}})),document.querySelectorAll(".popup__close").forEach((function(e){var o=e.closest(".popup");e.addEventListener("click",(function(){return t(o)})),document.addEventListener("keydown",(function(e){27==e.keyCode&&t(o)}));var n=document.querySelector(".form"),r=document.querySelector(".form-new"),c=document.querySelector(".picture__images"),u=document.querySelector(".form-photo");o.addEventListener("click",(function(e){n.contains(e.target)||r.contains(e.target)||c.contains(e.target)||u.contains(e.target)||t(o)}))})),h=document.querySelector("#new-mesto"),document.addEventListener("keydown",(function(e){13==e.keyCode&&o(h)})),function(e){var o=document.querySelector("#profile-edit"),n=document.querySelector("#profileName"),r=document.querySelector("#profileOccupation"),c=document.querySelector("#nameInput"),u=document.querySelector("#jobInput"),i=document.querySelector(".form"),a=document.querySelector("#save");c.setAttribute("value",n.innerText),u.setAttribute("value",r.innerText),i.addEventListener("click",(function(e){if(e.target.classList.contains("form__submit-button")){var c=document.getElementById("nameInput").value,u=document.getElementById("jobInput").value;n.textContent=c,r.textContent=u,a.textContent="Сохранение...",fetch("https://mesto.nomoreparties.co/v1/wbf-cohort-2/users/me ",{method:"PATCH",headers:{authorization:"cbaadd20-b391-4efb-b28f-0fe45b806ecd","Content-Type":"application/json"},body:JSON.stringify({name:c,about:u})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)})),t(o),document.querySelector("#nameInput").value="Жак-Ив-Кусто",document.querySelector("#jobInput").value="Исследователь океана"}}))}(),function(){var e=document.querySelector("#new-mesto"),r=document.querySelector("#nameImage"),c=document.querySelector("#addLink"),u=(document.querySelector(".add-button").addEventListener("click",(function(){return o(e)})),document.querySelector(".element__title"),document.querySelector(".element__image-element"),document.querySelector("#create"));r.setAttribute("value","Название"),c.setAttribute("value","Ссылка на картинку"),document.querySelector(".form-new").addEventListener("click",(function(o){if(o.target.classList.contains("form__submit-button")){var r=document.getElementById("nameImage").value,c=document.getElementById("addLink").value,i=document.querySelector(".elements"),l=document.querySelector("#card-template").content.querySelector(".element").cloneNode(!0);i.prepend(l);var m=i;document.querySelector(".element__title").textContent=r,document.querySelector(".element__image-element").setAttribute("src",c),document.querySelector(".element__image-element").setAttribute("alt",r),m.querySelector(".like").setAttribute("src",a),u.textContent="Создание...",m.querySelector(".element__picture").addEventListener("click",n,!0);var f=fetch("https://mesto.nomoreparties.co/v1/wbf-cohort-2/cards",{method:"POST",headers:{authorization:"cbaadd20-b391-4efb-b28f-0fe45b806ecd","Content-Type":"application/json"},body:JSON.stringify({name:r,link:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log(e)}));Promise.all([f]).then((function(o){fetch("https://mesto.nomoreparties.co/v1/wbf-cohort-2/cards",{method:"GET",headers:{authorization:"cbaadd20-b391-4efb-b28f-0fe45b806ecd","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(o){console.log(o),o.forEach((function(e){var t=e,o=t.name,n=t.link;if(o===r&&n===c){var u=t._id,i=t.likes.length;document.querySelector(".element__likes").textContent=i,document.querySelector(".element__likes").setAttribute("id",u),t.owner._id,m.querySelector(".delete").setAttribute("id","my"),m.querySelector(".delete").setAttribute("id",u),m.querySelector(".element__delete").addEventListener("click",d,!0),m.querySelector(".like").setAttribute("id",u),m.querySelector(".element__vector").addEventListener("click",s,!0)}})),m.querySelector(".element__vector").addEventListener("click",s,!0),m.querySelector(".element__delete").addEventListener("click",d,!0),document.querySelector("#nameImage").value="",document.querySelector("#addLink").value="",t(e);var n=document.querySelector("#create");n.setAttribute("disabled",!0),n.classList.add("form__submit-button_color_noactive")})).catch((function(e){console.log(e)}))}))}}))}(),function(){var e=document.querySelector("#editPhoto");document.querySelector(".profile__avatar").addEventListener("click",(function(){return o(e)}))}(),function(){var e=document.querySelector("#form"),t={name:function(e,t){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>40?"Максимальное количество символов:40":null:"Вы пропустили это поле"},job:function(e,t){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>200?"Максимальное количество символов:40":null:"Вы пропустили это поле"}},o={name:"#nameInputGroup",job:"#nameInputGroupSecond"};function n(t,n){var r=o[t],c=e.querySelector(r);c.querySelector(".form__field").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=n,u.classList.remove("form__error_hidden")}function r(e,o,n){return(0,t[e])(o,n)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),a=Object.fromEntries(i),l=r(c,u,a);l?n(c,l):function(t){var n=o[t],r=e.querySelector(n);r.querySelector(".form__field").classList.remove("form__input_invalid");var c=r.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var s=!0;if(i.forEach((function(e,t){var o=r(t,e,a);o&&(n(t,o),s=!1)})),!s){var d=document.querySelector("#save");return d.setAttribute("disabled",!0),void d.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#save");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(),function(){var e=document.querySelector("#form-new"),t={nameImage:function(e){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>30?"Максимальное количество символов:40":null:"Вы пропустили это поле"},addLink:function(e){if(!e)return"Вы пропустили это поле";var t=document.createElement("input");return t.type="url",t.required=!0,t.value=e,("function"==typeof t.checkValidity?t.checkValidity():/\S+@\S+\.\S+/.test(e))?null:"Введите адрес сайта"}},o={nameImage:"#nameCard",addLink:"#linkCard"};function n(t,n){var r=o[t],c=e.querySelector(r);c.querySelector(".form__field_name_text").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=n,u.classList.remove("form__error_hidden")}function r(e,o,n){return(0,t[e])(o,n)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),a=Object.fromEntries(i),l=r(c,u,a);l||l?n(c,l):function(t){var n=o[t],r=e.querySelector(n);r.querySelector(".form__field_name_text").classList.remove("form__input_invalid");var c=r.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var s=!0;if(i.forEach((function(e,t){var o=r(t,e,a);o&&(n(t,o),s=!1)})),!s){var d=document.querySelector("#create");return d.setAttribute("disabled",!0),void d.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#create");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault(),buttonCreate.setAttribute("disabled",!0),buttonCreate.classList.add("form__submit-button_color_noactive")}))}(),function(){var e=document.querySelector("#form-photo"),t={addLinkPhoto:function(e){if(!e)return"Вы пропустили это поле";var t=document.createElement("input");return t.type="url",t.required=!0,t.value=e,("function"==typeof t.checkValidity?t.checkValidity():/\S+@\S+\.\S+/.test(e))?null:"Введите адрес сайта"}},o={addLinkPhoto:"#linkCardPhoto"};function n(t,n){var r=o[t],c=e.querySelector(r);c.querySelector(".form__field_name_text").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=n,u.classList.remove("form__error_hidden")}function r(e,o,n){return(0,t[e])(o,n)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),a=Object.fromEntries(i),l=r(c,u,a);l||l?n(c,l):function(t){var n=o[t],r=e.querySelector(n);r.querySelector(".form__field_name_text").classList.remove("form__input_invalid");var c=r.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var s=!0;if(i.forEach((function(e,t){var o=r(t,e,a);o&&(n(t,o),s=!1)})),!s){var d=document.querySelector("#edit");return d.setAttribute("disabled",!0),void d.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#edit");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault(),buttonCreate.setAttribute("disabled",!0),buttonCreate.classList.add("form__submit-button_color_noactive")}))}()})();