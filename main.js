(()=>{"use strict";var e={};function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",(function(n){"Escape"===n.key&&t(e)}))}function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",(function(n){"Escape"===n.key&&t(e)}))}e.p="";var r={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-3",headers:{authorization:"e91d2d7a-7934-4811-b5d2-d42326a1cfb9","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function c(){return fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return o(e)}))}function u(){return fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return o(e)}))}const i=e.p+"e3b9ba5840ebe97bc077.svg",l=e.p+"35948469632d0421d697.svg";function a(e){var t=e.target;t.setAttribute("disabled",!0);var n=t.getAttribute("id");if(t.getAttribute("src")===i){var c=function(e){var t=e;return fetch("".concat(r.baseUrl,"/cards/likes/")+t,{method:"PUT",headers:r.headers}).then((function(e){return o(e)}))}(n);c.then((function(e){console.log(e),u().then((function(e){console.log(e),e.forEach((function(e){var r=e;r._id===n&&(r.name,document.querySelectorAll(".element__likes").forEach((function(e){if(e.getAttribute("id")===n){var o=r.likes.length;e.textContent=o,t.setAttribute("src",l)}})))}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}else{var a=function(e){var t=e;return fetch("".concat(r.baseUrl,"/cards/likes/")+t,{method:"DELETE",headers:r.headers}).then((function(e){return o(e)}))}(n);a.then((function(e){console.log(e),u().then((function(e){console.log(e),e.forEach((function(e){var r=e;r._id===n&&(r.name,document.querySelectorAll(".element__likes").forEach((function(e){if(e.getAttribute("id")===n){var o=r.likes.length;e.textContent=o,t.setAttribute("src",i)}})))}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}}function d(e){var t=e.target,n=t.getAttribute("id"),c=t.closest(".element");c.setAttribute("disabled",!0);var u=function(e){var t=e;return fetch("".concat(r.baseUrl,"/cards/")+t,{method:"DELETE",headers:r.headers}).then((function(e){return o(e)}))}(n);u.then((function(e){console.log(e),c.remove()})).catch((function(e){console.log(e)}))}function s(e){var t=e.target,n=t.getAttribute("src"),r=t.getAttribute("alt");document.querySelector(".picture__images").setAttribute("src",n),document.querySelector(".picture__caption").textContent=r}var m=document.querySelector("#profile-edit"),f=document.querySelector(".profile__edit-button"),_=document.querySelector("#editPhoto"),v=document.querySelector(".profile__avatar"),y=document.querySelectorAll(".popup__close"),S=document.querySelector(".form"),b=document.querySelector(".form-new"),h=document.querySelector(".picture__images"),q=document.querySelector(".form-photo"),g=document.querySelector("#new-mesto"),p=document.querySelector("#profileName"),L=document.querySelector("#profileOccupation"),k=document.querySelector("#nameInput"),E=document.querySelector("#jobInput"),A=document.querySelector("#save"),x=document.querySelector(".profile__avatar-img"),C=(document.querySelector("#profileAddLink"),document.querySelector(".form-photo")),I=document.querySelector("#edit"),T=document.querySelector("#picture"),w=(document.querySelector("#nameImage"),document.querySelector("#addLink"),document.querySelector(".add-button")),j=(document.querySelector(".element__title"),document.querySelector(".element__image-element"),document.querySelector("#create"));f.addEventListener("click",(function(){return n(m)})),v.addEventListener("click",(function(){return n(_)})),y.forEach((function(e){var n=e.closest(".popup");e.addEventListener("click",(function(){return t(n)})),n.addEventListener("click",(function(e){S.contains(e.target)||b.contains(e.target)||h.contains(e.target)||q.contains(e.target)||t(n)}))})),k.setAttribute("value",p.innerText),E.setAttribute("value",L.innerText),S.addEventListener("click",(function(e){if(e.target.classList.contains("form__submit-button")){var n=document.getElementById("nameInput").value,u=document.getElementById("jobInput").value;p.textContent=n,L.textContent=u,A.textContent="Сохранение...";var i=function(e,t){var n=e,c=t;return fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:n,about:c})}).then((function(e){return o(e)}))}(n,u);i.then((function(e){console.log(e),c().then((function(e){console.log(e)})).catch((function(e){console.log(e)})),t(m),A.setAttribute("disabled",!0),A.classList.add("form__submit-button_color_noactive"),A.textContent="Сохранить"})).catch((function(e){console.log(e)}))}})),C.addEventListener("click",(function(e){if(e.target.classList.contains("form__submit-button")){var n=document.getElementById("profileAddLink").value;x.setAttribute("src",n),I.textContent="Сохранение...";var u=function(e){var t=e;return console.log(t),fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})}).then((function(e){return o(e)}))}(n);u.then((function(e){console.log(e),c().then((function(e){console.log(e)})).catch((function(e){console.log(e)})),t(_),I.setAttribute("disabled",!0),I.classList.add("form__submit-button_color_noactive"),I.textContent="Сохранить"})).catch((function(e){console.log(e)})),document.querySelector("#profileAddLink").value=" "}}));var P=c(),U=u();Promise.all([P,U]).then((function(e){var t=e[0]._id;e[1].forEach((function(e){var r=function(e,t){var n=e,r=t,o=document.querySelector(".elements"),c=document.querySelector("#card-template").content.querySelector(".element").cloneNode(!0);o.prepend(c);var u=c,a=n.name,d=n.link,s=n._id,m=n.likes.length;document.querySelector(".element__likes").textContent=m,document.querySelector(".element__likes").setAttribute("id",s),n.likes.forEach((function(e){var t=e._id;r===t?u.querySelector(".like").setAttribute("src",l):u.querySelector(".like").setAttribute("src",i)}));var f=n.owner._id;return r===f?u.querySelector(".delete").setAttribute("id",s):u.querySelector(".delete").removeAttribute("src"),u.querySelector(".like").setAttribute("id",s),document.querySelector(".element__title").textContent=a,document.querySelector(".element__image-element").setAttribute("src",d),document.querySelector(".element__image-element").setAttribute("alt",a),document.querySelector(".element__image-element").setAttribute("id",s),u}(e,t);r.querySelector(".element__delete").addEventListener("click",d,!0),r.querySelector(".element__picture").addEventListener("click",(function(e){n(T)})),document.querySelectorAll(".element__image-element").forEach((function(e){e.addEventListener("click",s,!0)})),r.querySelector(".element__vector").addEventListener("click",a,!0)}))})).catch((function(e){console.log(e)})),w.addEventListener("click",(function(){return n(g)})),b.addEventListener("click",(function(e){if(e.target.classList.contains("form__submit-button")){var c=document.getElementById("nameImage").value,l=document.getElementById("addLink").value,m=function(e,t){var n=e,r=t,o=document.querySelector(".elements"),c=document.querySelector("#card-template").content.querySelector(".element").cloneNode(!0);o.prepend(c);var u=c;return document.querySelector(".element__title").textContent=n,document.querySelector(".element__image-element").setAttribute("src",r),document.querySelector(".element__image-element").setAttribute("alt",n),u.querySelector(".like").setAttribute("src",i),u}(c,l);j.textContent="Создание...",m.querySelector(".element__picture").addEventListener("click",(function(e){n(document.querySelector("#picture"))})),document.querySelectorAll(".element__image-element").forEach((function(e){e.addEventListener("click",s,!0)}));var f=function(e,t){var n=e,c=t;return fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:n,link:c})}).then((function(e){return o(e)}))}(c,l);f.then((function(e){console.log(e),u().then((function(e){console.log(e),e.forEach((function(e){var t=e,n=t.name,r=t.link;if(n===c&&r===l){var o=t._id,u=t.likes.length;document.querySelector(".element__likes").textContent=u,document.querySelector(".element__likes").setAttribute("id",o),t.owner._id,m.querySelector(".delete").setAttribute("id",o),m.querySelector(".element__delete").addEventListener("click",d,!0),m.querySelector(".like").setAttribute("id",o),m.querySelector(".element__vector").addEventListener("click",a,!0)}})),m.querySelector(".element__vector").addEventListener("click",a,!0),m.querySelector(".element__delete").addEventListener("click",d,!0),document.querySelector("#nameImage").value="",document.querySelector("#addLink").value=""})).catch((function(e){console.log(e)})),t(g),j.setAttribute("disabled",!0),j.classList.add("form__submit-button_color_noactive"),j.textContent="Создать"})).catch((function(e){console.log(e)}))}})),function(e,t){var n={name:"#nameInputGroup",job:"#nameInputGroupSecond"};function r(t,r){var o=n[t],c=e.querySelector(o);c.querySelector(".form__field").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=r,u.classList.remove("form__error_hidden")}function o(e,n,r){return(0,t[e])(n,r)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),l=Object.fromEntries(i),a=o(c,u,l);a?r(c,a):function(t){var r=n[t],o=e.querySelector(r);o.querySelector(".form__field").classList.remove("form__input_invalid");var c=o.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var d=!0;if(i.forEach((function(e,t){var n=o(t,e,l);n&&(r(t,n),d=!1)})),!d){var s=document.querySelector("#save");return s.setAttribute("disabled",!0),void s.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#save");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(document.querySelector("#form"),{name:function(e,t){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>40?"Максимальное количество символов:40":null:"Вы пропустили это поле"},job:function(e,t){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>200?"Максимальное количество символов:40":null:"Вы пропустили это поле"}}),function(e,t){var n={nameImage:"#nameCard",addLink:"#linkCard"};function r(t,r){var o=n[t],c=e.querySelector(o);c.querySelector(".form__field_name_text").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=r,u.classList.remove("form__error_hidden")}function o(e,n,r){return(0,t[e])(n,r)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),l=Object.fromEntries(i),a=o(c,u,l);a||a?r(c,a):function(t){var r=n[t],o=e.querySelector(r);o.querySelector(".form__field_name_text").classList.remove("form__input_invalid");var c=o.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var d=!0;if(i.forEach((function(e,t){var n=o(t,e,l);n&&(r(t,n),d=!1)})),!d){var s=document.querySelector("#create");return s.setAttribute("disabled",!0),void s.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#create");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(document.querySelector("#form-new"),{nameImage:function(e){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>30?"Максимальное количество символов:40":null:"Вы пропустили это поле"},addLink:function(e){if(!e)return"Вы пропустили это поле";var t=document.createElement("input");return t.type="url",t.required=!0,t.value=e,("function"==typeof t.checkValidity?t.checkValidity():/\S+@\S+\.\S+/.test(e))?null:"Введите адрес сайта"}}),function(e,t){var n={addLinkPhoto:"#linkCardPhoto"};function r(t,r){var o=n[t],c=e.querySelector(o);c.querySelector(".form__field_name_text").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=r,u.classList.remove("form__error_hidden")}function o(e,n,r){return(0,t[e])(n,r)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),l=Object.fromEntries(i),a=o(c,u,l);a||a?r(c,a):function(t){var r=n[t],o=e.querySelector(r);o.querySelector(".form__field_name_text").classList.remove("form__input_invalid");var c=o.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var d=!0;if(i.forEach((function(e,t){var n=o(t,e,l);n&&(r(t,n),d=!1)})),!d){var s=document.querySelector("#edit");return s.setAttribute("disabled",!0),void s.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#edit");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(document.querySelector("#form-photo"),{addLinkPhoto:function(e){if(!e)return"Вы пропустили это поле";var t=document.createElement("input");return t.type="url",t.required=!0,t.value=e,("function"==typeof t.checkValidity?t.checkValidity():/\S+@\S+\.\S+/.test(e))?null:"Введите адрес сайта"}})})();